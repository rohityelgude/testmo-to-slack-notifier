name: Debug Testmo API → Slack

on:
  workflow_dispatch:

jobs:
  debug-testmo:
    runs-on: ubuntu-latest
    steps:
      - name: Install jq
        run: sudo apt-get update && sudo apt-get install -y jq

      - name: Get latest Testmo automation run (debug mode)
        id: get_run
        run: |
          echo "📡 Calling Testmo API..."
          response=$(curl -s -H "Authorization: Bearer ${{ secrets.TESTMO_API_TOKEN }}" "https://${{ secrets.TESTMO_BASE_URL }}/api/v1/automation-runs?limit=1&sort=created_at:desc")

          echo "📝 Full API response below:"
          echo "$response"

          # Save JSON for later inspection
          echo "$response" > latest_run.json

          # Extract details (safe parsing with jq)
          latest_id=$(jq -r '.automation_runs[0].id // "NULL"' latest_run.json)
          status=$(jq -r '.automation_runs[0].status // "NULL"' latest_run.json)
          passed=$(jq -r
